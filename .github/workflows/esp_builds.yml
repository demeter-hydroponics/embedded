name: Build Node and Pump Controllers

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  # Job 1: Build Node Controller
  build_node_controller:
    runs-on: ubuntu-latest
    container:
      image: espressif/idf:latest
      options: --user root  # Optional: Run as root to avoid permission issues
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
        with:
          submodules: recursive

      - name: Setup ESP-IDF
        run: |
          . /opt/esp/idf/export.sh

      - name: Install Python Dependencies
        run: python -m pip install -r scripts/python_requirements.txt

      - name: Build Node Controller
        run: |
          python3 scripts/demeter_build_script.py --project=node-controller --build